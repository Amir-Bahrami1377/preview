@using System.Security.Claims
@inject IPermissionService PermissionService

@model ParvandehDto
@{
    Layout = "_Layout";
}

<div class="d-md-flex d-block align-items-center justify-content-between my-4 page-header-breadcrumb">
    <div>
        <p class="fw-semibold fs-18 mb-0">جستجوی پرونده</p>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item pointer">
                    <a asp-area="" asp-controller="Home" asp-action="Index">کارتابل</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">جستجوی پرونده</li>
            </ol>
        </nav>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card custom-card">
            <div class="card-header justify-content-between">
                <div class="card-title">
                    جستجو

                @if (!Model?.IsValid ?? false)
                {
                    <small class="text-danger"> ( داده های غیرمجاز ) </small>
                }
                </div>
            </div>
            <div class="card-body">
                <form method="POST" asp-controller="ParvandehInfo" asp-action="SearchParvandeh" id="SearchParvandehForm" autocomplete="off">
                    @Html.AntiForgeryToken()
                    <div class="row">
                        <div class="col-3">
                            <label class="form-label">نوع جستجو</label>
                            <select class="form-select form-select-sm" id="SearchParvandehNoeSearch" name="code">
                                <option value="1">شماره پرونده</option>
                                <option value="2">کد نوسازی</option>
                            </select>
                        </div>
                        <div class="col-3">
                            <label class="form-label" id="SearchParvandehLabel">شماره پرونده</label>
                            <input class="form-control form-control-sm form-la" id="SearchParvandehInput" name="value" />
                        </div>
                        <div class="col-3 d-flex align-items-end">
                            <button type="submit" class="btn btn-sm btn-success" id="SearchParvandehSubmit">جستجو</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12" id="SearchParvandehGrid">
        <div class="card custom-card">
            <div class="card-body">
                @if (Model != null)
                {
                    <table class="table table-bordered text-nowrap table-hover">
                        <thead class="table-primary">
                            <tr>
                                <th>کد نوسازی</th>
                                <th>شماره پرونده</th>
                                <th>عملیات</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="@(Model.IsValid ? "valid" : "not_valid")">@Model.codeN</td>
                                <td class="@(Model.IsValid ? "valid" : "not_valid")">@Model.shop</td>
                                <td class="@(Model.IsValid ? "valid" : "not_valid")">
                                    <div class="hstack gap-2 flex-wrap">
                                        @{
                                            var ParvandehInfo = await PermissionService.HasPermissionAsync(User.FindFirstValue(ClaimTypes.NameIdentifier), "Menu_ParvandehInfo");
                                            var SabtDarkhast = await PermissionService.HasPermissionAsync(User.FindFirstValue(ClaimTypes.NameIdentifier), "SearchParvandeh_SabtDarkhast");

                                            if (ParvandehInfo)
                                            {
                                                <form method="post" asp-area="Parvandeh" asp-controller="ParvandehInfo" asp-action="Index">
                                                    @Html.AntiForgeryToken()
                                                    <input type="hidden" name="shop" value="@Model.shop" />
                                                    <button type="submit" class="btn btn-sm btn-success">اطلاعات پرونده</button>
                                                </form>

                                            }
                                            if (SabtDarkhast)
                                            {
                                                <form method="post" asp-area="Darkhast" asp-controller="SabtDarkhast" asp-action="Index">
                                                    @Html.AntiForgeryToken()
                                                    <input type="hidden" name="shop" value="@Model.shop" />
                                                    <input type="hidden" name="codeNosazi" value="@Model.codeN" />
                                                    <button type="submit" class="btn btn-sm btn-info">ثبت درخواست</button>
                                                </form>

                                            }
                                        }
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                }
                else
                {
                    <div class="alert alert-danger" role="alert"> موردی برای نمایش وجود ندارد! </div>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts
{
    <script src="~/js/areas/parvandeh/searchparvandeh.js"></script>
}
